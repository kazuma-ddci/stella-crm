# /record コマンド

ユーザーが指定した内容を適切なドキュメントに構造化して記録してください。

## 記録先の判断基準

| カテゴリ | 記録先 | 例 |
|---------|--------|-----|
| **確定仕様（変更禁止）** | `docs/specs/SPEC-*.md` 新規作成 + `docs/specs/index.md` 更新 | UI表示形式、特定のロジック |
| エラー修正・トラブル | `docs/troubleshooting.md` | バグ修正、ライブラリの問題対処 |
| ビジネスロジック | `docs/business-logic.md` | 業務フロー、データ処理ルール |
| コンポーネント仕様 | `docs/components/` 配下 | CrudTable、インライン編集など |
| DB変更 | `docs/DATABASE.md` | テーブル追加、カラム変更 |
| マスタデータ | `docs/master-data.md` | 選択肢、初期データ |

## 必須出力形式（構造化記録）

### 確定仕様の場合

新規SPECファイルを作成し、以下の形式で記録：

```markdown
# SPEC-XXX-NNN: [タイトル]

## メタ情報

| 項目 | 値 |
|------|-----|
| SPEC ID | SPEC-XXX-NNN |
| ステータス | ✅ confirmed |
| オーナー | - |
| 最終更新 | YYYY-MM-DD |
| 関連ファイル | `path/to/file.tsx` |

## 背景（なぜこの仕様が必要か）

[決定に至った経緯、問題の背景]

## 決定事項

[確定した仕様の詳細]

## 禁止事項（forbidden_changes）

- ❌ [禁止事項1]
- ❌ [禁止事項2]

## 影響範囲

- 関連ファイル: `path/to/file.tsx`
- 関連コンポーネント: [コンポーネント名]

## 検証方法

- ガードテスト: `tests/specs/SPEC-XXX-NNN.test.ts`
- 手動確認手順: [手順があれば]

## ロールバック手順

この仕様を取り消す場合の手順：

1. [手順1]
2. [手順2]

## 変更履歴

| 日付 | 変更内容 | 承認者 |
|------|---------|--------|
| YYYY-MM-DD | 初版作成 | - |
```

### エラー修正・その他の場合

```markdown
## [問題/決定の概要]

### 背景

[なぜこの問題が発生したか、なぜこの決定が必要か]

### 決定事項

[決定した内容、解決方法]

### 影響範囲

- 関連ファイル: `path/to/file.tsx`

### 検証方法

[どうやって正しく動作していることを確認するか]

### ロールバック手順

[問題が発生した場合の復旧手順]

### 関連ファイル

- `ファイルパス`
```

## 引数

| 引数 | 説明 | 例 |
|------|------|-----|
| なし | 会話全体から記録すべき内容を提案 | `/record` |
| `--last` | 直前のやり取りのみを対象 | `/record --last` |
| `--dry-run` | 記録内容を表示するが実際には書き込まない | `/record --dry-run` |
| 指定テキスト | 指定された内容を記録 | `/record 確定仕様: 顧問の表示形式は...` |

## 実行手順

### 1. 内容の抽出（`--dry-run` または引数なし）

会話をスキャンし、以下を抽出：

- 確定した仕様・決定事項
- 修正したエラー・バグ
- 重要な設計判断
- ユーザーが「これは変えないで」と言った内容

### 2. カテゴリの判定と記録先の決定

抽出した内容をカテゴリ分類し、記録先を提案。

### 3. 構造化して記録

必須フィールドを全て埋めて記録：
- 背景
- 決定事項
- 影響範囲
- 検証方法
- ロールバック手順

### 4. インデックス更新（確定仕様の場合）

`docs/specs/index.md` の一覧を更新。

### 5. 確認

```
✅ 記録完了

記録先: docs/specs/SPEC-STP-002.md
カテゴリ: 確定仕様
タイトル: [タイトル]

インデックス更新: docs/specs/index.md
```

## 使用例

```
/record                    # 会話全体から記録すべき内容を提案
/record --last             # 直前のやり取りのみ
/record --dry-run          # 提案のみ（書き込みなし）
/record 確定仕様: 顧問の表示形式は「顧問（件数 / 金額）」で統一
```

## 注意事項

- **経緯を含める**: なぜその決定に至ったかの背景
- **コード例を含める**: 正しい実装例と間違い例
- **関連ファイルを明記**: どのファイルに影響するか
- **検証方法を明記**: どうやって確認するか
- **ロールバック手順**: 問題時の復旧方法
